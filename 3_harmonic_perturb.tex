\chapter{Harmonic perturbations}
\label{sec:harmonic_distorsion}
\section{Data analysis}

\section{Correction}
\section{Example: the 10 Hz perturbation}

\begin{python}[caption={Perturbation localisation, f = 10 Hz}]
	import matplotlib.plt as plt
	import search_kick.core as skcore
	import search_kick.tools as sktools
	
	# Dataset
	phase = ...
	tune = ...
	time_signal = ....  # nb_bpms lines, nb_samples colunms
	fs = 500  # sampling rate (Hz)
	
	f = 10  # frequency to extract (Hz)
	
	# Extract cosine and sine amplitude with a FFT transform
	a, b = skcore.extract_cos_sin_withfft(values, fs, f)
	
	# Optimize to only have the sine amplitude
	step_size = 0.1
	a_opt, b_opt, alpha_0 = sktools.maths.optimize_rotation(a, b, step_size)
	
	# Get the kick
	kick, sin_coef = skcore.get_kick(a_opt, phase, tune)
	sine, phase_th = skcore.build_sine(kick_phase, tune, sin_coef)
	
	# Plot the results
	plt.plot(phase, a_opt, '-b')
	plt.plot(phase, b_opt, '-m')  # cosine amplitudes: to be sure that it was a unique perturbation
	plt.plot(phase_th, sine, '-g')
	plt.axvline(kick, -2, 2)
	
\end{python}